<h1 class="mt-3 d-flex justify-content-between align-items-center">Join A Game<button class="btn btn-primary" style="padding: 10px;" onclick="loadContent('create');">Create</button></h1>

<ul id="room_list" class="list-group list-group-flush"></ul>

<div id="room-loader" class="spinner-border mx-auto mt-5 text-primary" role="status" style="display: block; width: 5rem; height: 5rem;">
    <span class="sr-only">Loading...</span>
</div>

<script>
//Get list of open rooms
firebase.database().ref('/rooms/').once('value').then( (data) => {
    var room_list = firebase.database().ref('/rooms/');
    $('#room-loader').hide();

    room_list.on('child_added', (data) => {
        $('#room_list').append(`
            <div id="room_${ data.key }" class="room-item d-flex" ${ data.val().full === false ? `onclick="enterName('${ data.key }')"` : 'class="room-item disabled d-flex"' }>
                <li class="list-group-item list-group-item-dark w-100 d-flex justify-content-between align-items-center">
                    ${ data.key }
                    ${ data.val().full === false ? `
                        <span>${ data.val().player_count }/${ data.val().max_players }</span>
                    ` : '<span>Full</span>' }
                </li>
                ${ data.val().full === false ? `
                <button class="btn btn-primary list-btn">Join</button>
                ` : '<button class="btn btn-primary list-btn disabled">Join</button>' }
            </div>
        `);
        noRooms();
    });

    noRooms();

}).catch( (error) => {

});

function noRooms() {
    if ($('#room_list').children().length === 0)
        $('#room_list').after(`<div id="no_room_error" class="text-center alert alert-danger">No rooms were found.</div>`);
    else
        $('#no_room_error').remove();
}
function enterName(room_name) {
    $('#auth-content').html(`
        <form id="login-form" class="login" onsubmit="return false;">
            <input id="name-input" class="minimal-input" type="text" name="login-name" placeholder="Display Name">
            <button id="login-btn" type="submit" class="btn btn-primary w-100" onclick="join('${ room_name }')">Enter</button>
            <button id="login-btn" type="submit" class="btn btn-danger w-100 mt-3" onclick="$('#auth-overlay').fadeOut('fast');">Close</button>
        </form>
                `);
    $('#auth-overlay').fadeIn('fast');

}
function join(room_name) {
   let name = $('#name-input').val();
   if (name)
    firebase.database().ref('/rooms/' + room_name + '/players/' + name).set({
        "joined": Date.now(),
        "lastUpdate": Date.now()
    }).then( (data) => {
        console.log("WORK")
        $('#auth-overlay').fadeOut('fast', loadContent('room'));
    });
}
</script>

<style>
.room-item:not(.disabled) {
    transition: .2s;
}

.room-item:not(.disabled):hover {
    transform: scale(1.02);
    cursor: pointer;
    background-color: var(--tertiary-color) !important;
}
</style>